{% extends "theme/base.html" %}

{% block title %}Low Stock Alerts{% endblock %}
{% block page_title %}Low Stock Report{% endblock %}
{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'reports_dashboard' %}">Reports</a></li>
<li class="breadcrumb-item active">Low Stock</li>
{% endblock %}

{% block content %}
<div class="card card-outline card-warning">
  <div class="card-header">
    <h3 class="card-title"><i class="fas fa-exclamation-triangle text-warning mr-2"></i> Low Stock Alerts</h3>
    <div class="card-tools">
      <span class="badge bg-warning text-dark mr-2">{{ rows|length }} item{{ rows|length|pluralize }}</span>
      <button type="button" class="btn btn-sm btn-success mr-1 wis-export-excel"><i class="fas fa-file-excel mr-1"></i> Excel</button>
      <button type="button" class="btn btn-sm btn-outline-danger wis-export-pdf"><i class="fas fa-file-pdf mr-1"></i> PDF</button>
    </div>
  </div>
  <div class="card-body table-responsive p-0">
    <table class="table table-hover table-striped text-nowrap" id="report-table">
      <thead>
        <tr>
          <th>Image</th>
          <th>Item Code</th>
          <th>Item Name</th>
          <th>Unit</th>
          <th class="text-right">Reorder Point</th>
          <th class="text-right">On Hand</th>
          <th class="text-right">Deficit</th>
          <th style="min-width:120px;">Stock Level</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr>
          <td class="text-center">
            {% if row.item.image %}
              <img src="{{ row.item.image.url }}" alt="{{ row.item.name }}" class="item-thumb" loading="lazy">
            {% else %}
              <span class="item-thumb-placeholder"><i class="fas fa-box"></i></span>
            {% endif %}
          </td>
          <td><a href="{% url 'item_detail' row.item.pk %}">{{ row.item.code }}</a></td>
          <td>{{ row.item.name }}</td>
          <td>{{ row.item.default_unit.abbreviation }}</td>
          <td class="text-right">{{ row.item.reorder_point|floatformat:2 }}</td>
          <td class="text-right">{{ row.qty_on_hand|floatformat:2 }}</td>
          <td class="text-right text-danger font-weight-bold">{{ row.deficit|floatformat:2 }}</td>
          <td>
            <div class="progress progress-sm" style="height:8px;" title="{{ row.stock_pct|floatformat:0 }}%">
              <div class="progress-bar {% if row.stock_pct <= 0 %}bg-danger{% elif row.stock_pct < 50 %}bg-warning{% else %}bg-info{% endif %}" style="width:{{ row.stock_pct|floatformat:0 }}%"></div>
            </div>
          </td>
          <td>
            {% if row.qty_on_hand <= 0 %}
              <span class="badge bg-danger">Out of Stock</span>
            {% else %}
              <span class="badge bg-warning text-dark">Low</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="9" class="text-center text-muted py-4"><i class="fas fa-check-circle mr-2 text-success"></i>All items are above reorder point.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
